webpackJsonp([56],{"92+C":function(t,e,a){"use strict";function r(t){a("dCbH")}Object.defineProperty(e,"__esModule",{value:!0});var s=a("BO1k"),l=a.n(s),o=a("iVC1"),n=a("QmSG"),i=a("nSkA"),c=a("0xDb"),u={components:{},data:function(){return{route_path:this.$route.path.split("/"),tableData:[],tabletotal:0,currentPage:1,ticket_status:"",pagesize:n.pagesize,pageformat:n.pageformat,rowdata:{id:"",status:""},STATUS_TEXT:{0:"未上线",1:"已上线"},listQuery:{limit:n.LIMIT,offset:"",create_user__username:"",search:"",ordering:""},toolbars:{preview:!0,bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,ol:!0,help:!0},statusForm:!1,addForm:!1,ruleForm:{name:"",content:"",create_user:localStorage.getItem("username")},rules:{name:[{required:!0,message:"请输入工单标题",trigger:"blur"}],content:[{required:!0,message:"请输入工单内容",trigger:"blur"}]},uploadurl:n.uploadurl,apiurl:n.apiUrl,fileList:[],count:0,enclosureForm:{ticket:"",create_user:localStorage.getItem("username"),file:""},enclosureData:[],showForm:!1,send_acc:!1,send_cs:!1}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;Object(o.g)(this.listQuery).then(function(e){t.tableData=e.data.results,t.tabletotal=e.data.count})},EnclosureData:function(t){var e=this,a={ticket__id:t};Object(o.h)(a).then(function(t){e.enclosureData=t.data})},getEncloseur:function(t){this.showForm=!0,this.EnclosureData(t)},searchClick:function(){this.fetchData()},handleSizeChange:function(t){this.listQuery.limit=t,this.fetchData()},handleCurrentChange:function(t){this.listQuery.offset=(t-1)*n.LIMIT,this.fetchData()},handleSuccess:function(t,e){this.fileList.push(e.raw),this.count+=1},handleRemove:function(t,e){this.fileList.remove(t),this.count-=1},changeStatus:function(t){this.statusForm=!0,this.rowdata=t},updateStatus:function(){var t=this;Object(o.n)(this.rowdata.id,this.rowdata).then(function(){if("1"===t.rowdata.status){var e={action_user:"molly,linda",title:"【已上线】"+t.rowdata.name,message:"上线内容: "+t.rowdata.content};Object(i.h)(e)}t.fetchData(),t.statusForm=!1})},handleSortChange:function(t){"ascending"===t.order?this.listQuery.ordering=t.prop:"descending"===t.order?this.listQuery.ordering="-"+t.prop:this.listQuery.ordering="",this.fetchData()},postForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;Object(o.p)(e.ruleForm).then(function(t){e.$message({type:"success",message:"恭喜你，新建成功"});var a=!0,r=!1,s=void 0;try{for(var n,u=l()(e.fileList);!(a=(n=u.next()).done);a=!0){var d=n.value,p=new FormData;p.append("username",e.enclosureForm.create_user),p.append("file",d),p.append("create_time",Object(c.a)(d.uid)),p.append("type",d.type),p.append("archive",e.route_path[1]),Object(i.i)(p).then(function(a){e.enclosureForm.file=a.data.filepath,e.enclosureForm.ticket=t.data.id,Object(o.q)(e.enclosureForm)})}}catch(t){r=!0,s=t}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}var f={action_user:"itsupport",title:"【上线申请】"+e.ruleForm.name,message:"上线内容: "+e.ruleForm.content};Object(i.h)(f),e.addForm=!1,e.fetchData()})})},deleteEnclosure:function(t){Object(o.b)(t),this.EnclosureData(t)}}},d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"components-container",staticStyle:{height:"100vh"}},[a("el-card",[a("div",{staticClass:"head-lavel"},[a("div",{staticClass:"table-button"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.addForm=!0}}},[t._v("新建")])],1),t._v(" "),a("div",{staticClass:"table-search"},[a("el-input",{attrs:{placeholder:"search"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.searchClick(e)}},model:{value:t.listQuery.search,callback:function(e){t.$set(t.listQuery,"search",e)},expression:"listQuery.search"}},[a("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},on:{click:t.searchClick},slot:"suffix"})])],1)]),t._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""},on:{"sort-change":t.handleSortChange}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"标题"}}),t._v(" "),a("el-table-column",{attrs:{prop:"content",label:"内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{slot:"reference"},slot:"reference"},[a("el-popover",{attrs:{placement:"top",width:"300",trigger:"hover",content:e.row.content}},[a("el-button",{attrs:{slot:"reference",size:"mini"},slot:"reference"},[t._v(t._s(e.row.content.slice(0,10))+"...")])],1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"工单状态",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",staticStyle:{"text-align":"center",color:"rgb(0,0,0)"},attrs:{slot:"reference"},slot:"reference"},[a("el-tag",[t._v("\n                "+t._s(t.STATUS_TEXT[e.row.status])+"\n              ")]),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"更新状态",placement:"top"}},[a("el-button",{staticClass:"modifychange",attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){t.changeStatus(e.row)}}})],1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"create_user",label:"创建人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",staticStyle:{"text-align":"center",color:"rgb(0,0,0)"},attrs:{slot:"reference"},slot:"reference"},[a("span",[t._v(t._s(t._f("parseDate")(e.row.create_time)))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(a){t.getEncloseur(e.row.id)}}},[t._v("附件")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){t.deleteGroup(e.row.id)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("div",{staticClass:"table-footer"},[a("div",{staticClass:"table-button"}),t._v(" "),a("div",{staticClass:"table-pagination"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":t.pagesize,"page-size":t.listQuery.limit,layout:t.pageformat,total:t.tabletotal},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e}}})],1)])]),t._v(" "),a("el-dialog",{attrs:{visible:t.statusForm},on:{"update:visible":function(e){t.statusForm=e}}},[a("el-form",{ref:"ruleForm",attrs:{model:t.rowdata,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"状态",prop:"status"}},t._l(Object.keys(t.STATUS_TEXT),function(e){return a("el-radio",{key:e,attrs:{label:e},model:{value:t.rowdata.status,callback:function(e){t.$set(t.rowdata,"status",e)},expression:"rowdata.status"}},[t._v("\n          "+t._s(t.STATUS_TEXT[e])+"\n        ")])})),t._v(" "),a("el-form-item",{attrs:{label:"通知对象"}},[a("el-checkbox",{model:{value:t.rowdata.send_acc,callback:function(e){t.$set(t.rowdata,"send_acc",e)},expression:"rowdata.send_acc"}},[t._v("财务")]),t._v(" "),a("el-checkbox",{model:{value:t.rowdata.send_cs,callback:function(e){t.$set(t.rowdata,"send_cs",e)},expression:"rowdata.send_cs"}},[t._v("客服")])],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.statusForm=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.updateStatus}},[t._v("确 定")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.addForm},on:{"update:visible":function(e){t.addForm=e}}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"标题",prop:"name"}},[a("el-input",{model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"内容",prop:"content"}},[a("mavon-editor",{staticStyle:{"z-index":"1"},attrs:{code_style:"monokai",toolbars:t.toolbars},model:{value:t.ruleForm.content,callback:function(e){t.$set(t.ruleForm,"content",e)},expression:"ruleForm.content"}}),t._v(" "),a("a",{staticClass:"tips"},[t._v(" Tip：截图可以直接 Ctrl + v 粘贴到工单内容里面")])],1),t._v(" "),a("el-form-item",[a("hr",{staticClass:"heng"}),t._v(" "),a("el-upload",{ref:"upload",attrs:{action:t.uploadurl,"on-success":t.handleSuccess,"on-remove":t.handleRemove,"file-list":t.fileList}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary",disabled:t.count>2},slot:"trigger"},[t._v("\n            上传文件\n          ")]),t._v("\n          (可以不用上传)\n          "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[a("p",[t._v("上传文件不超过10m，"),a("a",{staticStyle:{color:"red"}},[t._v("最多只能上传3个文件")])])])],1),t._v(" "),a("hr",{staticClass:"heng"})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.postForm("ruleForm")}}},[t._v("提交")]),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(e){t.resetForm("ruleForm")}}},[t._v("清空")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.showForm},on:{"update:visible":function(e){t.showForm=e}}},[t.enclosureData.length>0?a("div",{staticClass:"ticketenclosure"},[a("ul",t._l(t.enclosureData,function(e){return e.file?a("li",{key:e.id,staticStyle:{"list-style":"none"}},[a("i",{staticClass:"fa fa-paperclip"}),t._v(" "),a("a",{attrs:{href:t.apiurl+"/upload/"+e.file,download:e.file}},[t._v(t._s(e.file.split("/")[1]))])]):t._e()}))]):a("div",[t._v("\n      没有上传附件\n    ")])])],1)},p=[],f={render:d,staticRenderFns:p},m=f,h=a("VU/8"),v=r,_=h(u,m,!1,v,null,null);e.default=_.exports},dCbH:function(t,e,a){var r=a("y/jX");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("5a02a268",r,!0)},"y/jX":function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".modifychange{margin:5px}",""])}});