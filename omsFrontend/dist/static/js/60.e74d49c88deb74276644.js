webpackJsonp([60],{"/VfJ":function(t,e,a){var n=a("fK2C");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("rjj0")("bf12d0a4",n,!0)},IQjg:function(t,e,a){"use strict";function n(t){a("/VfJ")}Object.defineProperty(e,"__esModule",{value:!0});var s=a("Dd8w"),o=a.n(s),i=a("iVC1"),r=a("QmSG"),l=a("nSkA"),c=a("NYxO"),u=a("iOve"),d=a("tiaS"),p={components:{addGroup:u.default,editGroup:d.default},data:function(){return{tableData:[],tabletotal:0,currentPage:1,ticket_status:"",pagesize:r.pagesize,pageformat:r.pageformat,rowdata:{id:"",status:3},STATUS_TEXT:{0:"未上线",1:"通过",2:"未通过",3:"已上线"},STATUS_COLOR:{0:"danger",1:"success",2:"info",3:"primary"},listQuery:{limit:r.LIMIT,offset:"",create_user__username:"",search:"",ordering:""},onlineForm:!1,addForm:!1,apiurl:r.apiUrl,enclosureData:[],showForm:!1,editForm:!1,send_acc:!1,send_cs:!1,send_it:!1,nopassForm:!1,nopass:{id:"",content:""},ticketdata:{}}},computed:o()({},Object(c.b)(["role"])),created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;Object(i.g)(this.listQuery).then(function(e){t.tableData=e.data.results,t.tabletotal=e.data.count})},EnclosureData:function(t){var e=this,a={ticket__id:t};Object(i.h)(a).then(function(t){e.enclosureData=t.data})},getEncloseur:function(t){this.showForm=!0,this.EnclosureData(t)},searchClick:function(){this.fetchData()},handleSizeChange:function(t){this.listQuery.limit=t,this.fetchData()},handleCurrentChange:function(t){this.listQuery.offset=(t-1)*r.LIMIT,this.fetchData()},changeJobPass:function(t){var e=this,a={status:1};Object(i.m)(t.id,a).then(function(){var a={action_user:"itsupport",title:"【上线申请通过】"+t.name,message:"上线内容: "+t.version};Object(l.h)(a),e.fetchData()})},changeJobNopass:function(t){this.nopass.id=t.id,this.nopass.name=t.name,this.nopassForm=!0},updateNopass:function(){var t=this,e={status:2};Object(i.m)(this.nopass.id,e).then(function(){var e={action_user:"itsupport",title:"【申请未通过】"+t.nopass.name,message:"原因: "+t.nopass.content};Object(l.h)(e),t.nopassForm=!1,t.fetchData()})},changeSqlOnline:function(t){this.onlineForm=!0,this.rowdata.id=t.id,this.rowdata.name=t.name,this.rowdata.content=t.content},updateOnline:function(){var t=this;Object(i.m)(this.rowdata.id,this.rowdata).then(function(){if(t.send_acc){var e={action_user:"molly",title:"【已上线】"+t.rowdata.name,message:"上线内容: "+t.rowdata.content};Object(l.h)(e)}if(t.send_cs){var a={action_user:"linda",title:"【已上线】"+t.rowdata.name,message:"上线内容: "+t.rowdata.content};Object(l.h)(a)}if(t.send_it){var n={action_user:"ITDept_SkypeID",title:"【已上线】"+t.rowdata.name,message:"上线内容: "+t.rowdata.content};Object(l.h)(n)}t.fetchData(),t.onlineForm=!1})},handleSortChange:function(t){"ascending"===t.order?this.listQuery.ordering=t.prop:"descending"===t.order?this.listQuery.ordering="-"+t.prop:this.listQuery.ordering="",this.fetchData()},editBefore:function(t){this.editForm=!0,this.ticketdata=t},cleanForm:function(){this.send_acc=!1,this.send_cs=!1},getDialogStatus:function(t){this.addForm=t,this.editForm=t,this.fetchData()}}},f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"components-container",staticStyle:{height:"100vh"}},[a("el-card",[a("div",{staticClass:"head-lavel"},[a("div",{staticClass:"table-button"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.addForm=!0}}},[t._v("新建")])],1),t._v(" "),a("div",{staticClass:"table-search"},[a("el-input",{attrs:{placeholder:"search"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.searchClick(e)}},model:{value:t.listQuery.search,callback:function(e){t.$set(t.listQuery,"search",e)},expression:"listQuery.search"}},[a("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},on:{click:t.searchClick},slot:"suffix"})])],1)]),t._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""},on:{"sort-change":t.handleSortChange}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"标题"}}),t._v(" "),a("el-table-column",{attrs:{prop:"version",label:"项目和版本"}}),t._v(" "),a("el-table-column",{attrs:{prop:"content",label:"内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{slot:"reference"},slot:"reference"},[a("el-popover",{attrs:{placement:"top",width:"300",trigger:"hover",content:e.row.content}},[a("el-button",{attrs:{slot:"reference",size:"mini"},slot:"reference"},[t._v(t._s(e.row.content.slice(0,5))+"...")])],1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"工单状态",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",staticStyle:{"text-align":"center",color:"rgb(0,0,0)"},attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{type:t.STATUS_COLOR[e.row.status]}},[t._v("\n                "+t._s(t.STATUS_TEXT[e.row.status])+"\n              ")])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"create_user",label:"创建人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"desc",label:"说明"}}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",staticStyle:{"text-align":"center",color:"rgb(0,0,0)"},attrs:{slot:"reference"},slot:"reference"},[a("span",[t._v(t._s(t._f("parseDate")(e.row.create_time)))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.status&&"super"===t.role?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){t.editBefore(e.row)}}},[t._v("修改\n            ")]):t._e(),t._v(" "),"super"===t.role?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){t.changeSqlOnline(e.row)}}},[t._v("\n              已执行\n            ")]):t._e()]}}])})],1)],1),t._v(" "),a("div",{staticClass:"table-footer"},[a("div",{staticClass:"table-button"}),t._v(" "),a("div",{staticClass:"table-pagination"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":t.pagesize,"page-size":t.listQuery.limit,layout:t.pageformat,total:t.tabletotal},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e}}})],1)])]),t._v(" "),a("el-dialog",{attrs:{visible:t.onlineForm},on:{"update:visible":function(e){t.onlineForm=e},close:t.cleanForm}},[a("el-form",{ref:"ruleForm",attrs:{model:t.rowdata,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"通知对象"}},[a("el-checkbox",{model:{value:t.send_acc,callback:function(e){t.send_acc=e},expression:"send_acc"}},[t._v("财务")]),t._v(" "),a("el-checkbox",{model:{value:t.send_cs,callback:function(e){t.send_cs=e},expression:"send_cs"}},[t._v("客服")]),t._v(" "),a("el-checkbox",{model:{value:t.send_it,callback:function(e){t.send_it=e},expression:"send_it"}},[t._v("部门群组")])],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.onlineForm=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.updateOnline}},[t._v("确 定")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.nopassForm},on:{"update:visible":function(e){t.nopassForm=e},close:t.cleanForm}},[a("el-form",{ref:"ruleForm",attrs:{model:t.nopass,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"原因"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:10}},model:{value:t.nopass.content,callback:function(e){t.$set(t.nopass,"content",e)},expression:"nopass.content"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.nopassForm=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.updateNopass}},[t._v("确 定")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.addForm},on:{"update:visible":function(e){t.addForm=e}}},[a("add-group",{on:{DialogStatus:t.getDialogStatus}})],1),t._v(" "),a("el-dialog",{attrs:{visible:t.editForm},on:{"update:visible":function(e){t.editForm=e}}},[a("edit-group",{attrs:{ruleForm:t.ticketdata},on:{DialogStatus:t.getDialogStatus}})],1),t._v(" "),a("el-dialog",{attrs:{visible:t.showForm},on:{"update:visible":function(e){t.showForm=e}}},[t.enclosureData.length>0?a("div",{staticClass:"ticketenclosure"},[a("ul",t._l(t.enclosureData,function(e){return e.file?a("li",{key:e.id,staticStyle:{"list-style":"none"}},[a("i",{staticClass:"fa fa-paperclip"}),t._v(" "),a("a",{attrs:{href:t.apiurl+"/upload/"+e.file,download:e.file}},[t._v(t._s(e.file.split("/")[1]))])]):t._e()}))]):a("div",[t._v("\n      没有上传附件\n    ")])])],1)},h=[],m={render:f,staticRenderFns:h},_=m,v=a("VU/8"),b=n,g=v(p,_,!1,b,null,null);e.default=g.exports},fK2C:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,"",""])}});