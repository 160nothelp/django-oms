webpackJsonp([55],{"4bMg":function(t,e,a){"use strict";function s(t){a("iy2W")}Object.defineProperty(e,"__esModule",{value:!0});var i=a("lLHC"),n=a("nSkA"),o=a("Xoog"),r=a.n(o),c=a("1n3Z"),l=a("0xDb"),d=a("vMJZ"),p=a("QmSG"),h={components:{VueMarkdown:r.a,BackToTop:c.a},data:function(){return{route_path:this.$route.path.split("/"),pid:this.$route.params.id,ticketData:{},commentData:{},commentForm:{project:"",create_user:localStorage.getItem("username"),content:""},rowdata:{status:"",start_time:"",end_time:""},toolbars:{preview:!0,bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,ol:!0,help:!0},BackToTopStyle:{right:"50px",bottom:"50px",width:"40px",height:"40px","border-radius":"50px","line-height":"45px",background:"#a2fdff"},Project_Status:{0:"未指派",1:"已指派",2:"处理中",3:"待测试",4:"测试中",5:"已测试",6:"待上线",7:"已上线"},showinput:!1,commentquery:{project__id:""},users:[],errortime:!1,apiurl:p.apiUrl}},created:function(){this.bugquery.project__id=this.testquery.project__id=this.commentquery.project__id=this.commentForm.project=this.pid,this.fetchData(),this.CommentData(),this.getProjectUsers()},methods:{fetchData:function(){var t=this;Object(i.f)(null,this.pid).then(function(e){t.ticketData=e.data,t.rowdata.start_time=e.data.start_time,t.rowdata.end_time=e.data.end_time})},patchForm:function(){var t=this;this.rowdata.status||(this.rowdata.status=this.ticketData.status),Object(i.h)(this.pid,this.rowdata).then(function(){t.$message({message:"恭喜你，编辑成功",type:"success"}),t.fetchData(),t.showinput=!1}).catch(function(e){t.$message.error("计划结束时间必须大于开始时间！"),console.log(e)})},imgAdd:function(t,e){var a=this.$refs.md,s=new FormData;s.append("username",this.username),s.append("file",e),s.append("create_time",Object(l.a)(e.lastModified)),s.append("type",e.type),s.append("archive",this.route_path[1]),Object(n.i)(s).then(function(e){a.$imglst2Url([[t,e.data.file]])})},getProjectUsers:function(){var t=this,e={groups__name:"ITDept"};Object(d.f)(e).then(function(e){t.users=e.data})},changeProjectstatus:function(){"2"===this.rowdata.status&&(this.rowdata.start_time=Object(l.b)())},changeProjectendtime:function(){var t=new Date(this.rowdata.start_time),e=new Date(this.rowdata.end_time),a=t.getTime();e.getTime()<a?(this.$message.error("计划结束时间必须大于开始时间！"),this.errortime=!0):this.errortime=!1}}},m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"components-container",staticStyle:{height:"100vh"}},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("a",{staticClass:"title"},[t._v(t._s(t.ticketData.name))]),t._v(" "),a("hr",{staticClass:"heng"}),t._v(" "),a("div",{staticClass:"appendInfo"},[a("a",{staticClass:"ticketinfo create_user"},[a("span",{staticClass:"han"},[t._v("\n                              创建时间：")]),t._v(t._s(t._f("parseDate")(t.ticketData.create_time)))]),t._v(" "),a("a",{staticClass:"ticketinfo create_user"},[a("span",{staticClass:"han"},[a("a",{staticClass:"shu"}),t._v("\n                              发起人：")]),t._v(t._s(t.ticketData.create_user))]),t._v(" "),a("a",{staticClass:"ticketinfo action_user"},[a("span",{staticClass:"han"},[a("a",{staticClass:"shu"}),t._v("\n                              指派人：")]),t._v(t._s(t.ticketData.action_user))]),t._v(" "),a("a",{staticClass:"shu"}),t._v(" "),a("span",{staticClass:"han"},[t._v("当前状态：")]),t._v(" "),a("el-tag",[t._v("\n          "+t._s(t.Project_Status[t.ticketData.status])+"\n        ")])],1),t._v(" "),a("div",{staticClass:"appendInfo"},[a("span",{staticClass:"han"},[t._v("任务开始时间：")]),t._v(" "),t.ticketData.start_time?a("a",{staticClass:"ticketinfo"},[t._v(t._s(t.ticketData.start_time))]):a("a",{staticClass:"ticketinfo"},[t._v("未设置")]),t._v(" "),a("a",{staticClass:"shu"}),t._v(" "),a("span",{staticClass:"han"},[t._v("计划结束时间：")]),t._v(" "),t.ticketData.end_time?a("a",{staticClass:"ticketinfo"},[t._v(t._s(t.ticketData.end_time))]):a("a",{staticClass:"ticketinfo"},[t._v("未设置")])]),t._v(" "),7!=t.ticketData.status?a("div",{staticClass:"appendInfo"},[a("span",{staticClass:"han"},[t._v("操作：")]),t._v(" "),t.showinput?t._e():a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(e){t.showinput=!0}}},[t._v("编辑")]),t._v(" "),t.showinput?a("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(e){t.showinput=!1}}},[t._v("收起")]):t._e(),t._v(" "),t.showinput?a("el-button",{attrs:{type:"primary",size:"small",disabled:t.errortime},on:{click:t.patchForm}},[t._v("确定\n        ")]):t._e(),t._v(" "),t.showinput?a("div",{staticClass:"action"},[a("el-select",{attrs:{filterable:"",placeholder:"更新任务状态"},on:{change:t.changeProjectstatus},model:{value:t.rowdata.status,callback:function(e){t.$set(t.rowdata,"status",e)},expression:"rowdata.status"}},t._l(t.Project_Status,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})})),t._v(" "),"2"!==t.rowdata.status||t.ticketData.end_time?t._e():a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"设置计划结束时间",disable:"have_endtime"},on:{change:t.changeProjectendtime},model:{value:t.rowdata.end_time,callback:function(e){t.$set(t.rowdata,"end_time",e)},expression:"rowdata.end_time"}})],1):t._e()],1):t._e()]),t._v(" "),a("vue-markdown",{attrs:{source:t.ticketData.content}})],1),t._v(" "),a("el-tooltip",{attrs:{placement:"top",content:"一路向西"}},[a("back-to-top",{attrs:{transitionName:"fade",customStyle:t.BackToTopStyle,visibilityHeight:300,backPosition:50}})],1)],1)},u=[],_={render:m,staticRenderFns:u},f=_,v=a("VU/8"),g=s,k=v(h,f,!1,g,null,null);e.default=k.exports},iy2W:function(t,e,a){var s=a("k1VB");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a("rjj0")("14e447be",s,!0)},k1VB:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".editticket{margin:50px;width:80%}.title{font-size:28px;font-weight:700;padding-left:10px}.right-title{font-size:20px;font-weight:600;padding-left:10px}.card-head-btn{float:right;padding:3px 0}.appendInfo{padding:5px;margin:5px}.action{margin:5px}.han{margin-left:5px}.content{margin:20px 5px}.ticketcomment{margin-top:20px;background-color:rgba(48,250,81,.17)}.ticketcomment .dialog-box{position:relative;left:100px;margin-left:-30px}.ticketcomment .dialog-box span{width:0;height:0;font-size:0;overflow:hidden;position:absolute}.ticketcomment .dialog-box span.bot{border-width:16px;border-style:solid dashed dashed;border-color:transparent rgba(48,250,81,.38) transparent transparent;top:10px;left:-30px}.ticketcomment .dialog-box .comment{border:1px solid rgba(255,164,186,.62);padding:6px;margin-bottom:10px;min-height:50px}.ticketcomment .dialog-box .comment .commenttime{float:right}",""])}});