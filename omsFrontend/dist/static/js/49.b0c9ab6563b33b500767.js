webpackJsonp([49],{"4bMg":function(t,a,e){"use strict";function s(t){e("DD1h")}Object.defineProperty(a,"__esModule",{value:!0});var i=e("lLHC"),n=e("nSkA"),o=e("Xoog"),r=e.n(o),c=e("1n3Z"),l=e("0xDb"),p=e("vMJZ"),d=e("QmSG"),h={components:{VueMarkdown:r.a,BackToTop:c.a},data:function(){return{route_path:this.$route.path.split("/"),pid:this.$route.params.id,ticketData:{},commentData:{},commentForm:{project:"",create_user:localStorage.getItem("username"),content:""},rowdata:{status:"",start_time:"",end_time:""},toolbars:{preview:!0,bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,ol:!0,help:!0},BackToTopStyle:{right:"50px",bottom:"50px",width:"40px",height:"40px","border-radius":"50px","line-height":"45px",background:"#a2fdff"},Project_Status:{0:"未指派",1:"已指派",2:"处理中",3:"待测试",4:"测试中",5:"已测试",6:"待上线",7:"已上线"},showinput:!1,commentquery:{project__id:""},users:[],errortime:!1,apiurl:d.apiUrl,enclosureData:[]}},created:function(){this.bugquery.project__id=this.testquery.project__id=this.commentquery.project__id=this.commentForm.project=this.pid,this.fetchData(),this.CommentData(),this.getProjectUsers(),this.fetchEnclosureData()},methods:{fetchData:function(){var t=this;Object(i.h)(null,this.pid).then(function(a){t.ticketData=a.data,t.rowdata.start_time=a.data.start_time,t.rowdata.end_time=a.data.end_time})},patchForm:function(){var t=this;this.rowdata.status||(this.rowdata.status=this.ticketData.status),Object(i.l)(this.pid,this.rowdata).then(function(){t.$message({message:"恭喜你，编辑成功",type:"success"}),t.fetchData(),t.showinput=!1}).catch(function(a){t.$message.error("计划结束时间必须大于开始时间！"),console.log(a)})},imgAdd:function(t,a){var e=this.$refs.md,s=new FormData;s.append("username",this.username),s.append("file",a),s.append("create_time",Object(l.a)(a.lastModified)),s.append("type",a.type),s.append("archive",this.route_path[1]),Object(n.i)(s).then(function(a){e.$imglst2Url([[t,a.data.file]])})},getProjectUsers:function(){var t=this,a={groups__name:"ITDept"};Object(p.f)(a).then(function(a){t.users=a.data})},changeProjectstatus:function(){"2"===this.rowdata.status&&(this.rowdata.start_time=Object(l.b)())},changeProjectendtime:function(){var t=new Date(this.rowdata.start_time),a=new Date(this.rowdata.end_time),e=t.getTime();a.getTime()<e?(this.$message.error("计划结束时间必须大于开始时间！"),this.errortime=!0):this.errortime=!1},fetchEnclosureData:function(){var t=this,a={project__id:this.pid};Object(i.i)(a).then(function(a){t.enclosureData=a.data})}}},u=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"components-container",staticStyle:{height:"100vh"}},[e("el-card",[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("a",{staticClass:"title"},[t._v(t._s(t.ticketData.name))]),t._v(" "),e("hr",{staticClass:"heng"}),t._v(" "),e("div",{staticClass:"appendInfo"},[e("a",{staticClass:"ticketinfo create_user"},[e("span",{staticClass:"han"},[t._v("\n                              创建时间：")]),t._v(t._s(t._f("parseDate")(t.ticketData.create_time)))]),t._v(" "),e("a",{staticClass:"ticketinfo create_user"},[e("span",{staticClass:"han"},[e("a",{staticClass:"shu"}),t._v("\n                              发起人：")]),t._v(t._s(t.ticketData.create_user))]),t._v(" "),e("a",{staticClass:"ticketinfo action_user"},[e("span",{staticClass:"han"},[e("a",{staticClass:"shu"}),t._v("\n                              指派人：")]),t._v(t._s(t.ticketData.action_user))]),t._v(" "),e("a",{staticClass:"shu"}),t._v(" "),e("span",{staticClass:"han"},[t._v("类型：")]),t._v(" "),e("a",[t._v(t._s(t.ticketData.type))]),t._v(" "),e("a",{staticClass:"shu"}),t._v(" "),e("span",{staticClass:"han"},[t._v("当前状态：")]),t._v(" "),e("el-tag",[t._v("\n          "+t._s(t.Project_Status[t.ticketData.status])+"\n        ")])],1),t._v(" "),e("div",{staticClass:"appendInfo"},[e("span",{staticClass:"han"},[t._v("任务开始时间：")]),t._v(" "),t.ticketData.start_time?e("a",{staticClass:"ticketinfo"},[t._v(t._s(t.ticketData.start_time))]):e("a",{staticClass:"ticketinfo"},[t._v("未设置")]),t._v(" "),e("a",{staticClass:"shu"}),t._v(" "),e("span",{staticClass:"han"},[t._v("计划结束时间：")]),t._v(" "),t.ticketData.end_time?e("a",{staticClass:"ticketinfo"},[t._v(t._s(t.ticketData.end_time))]):e("a",{staticClass:"ticketinfo"},[t._v("未设置")])]),t._v(" "),7!=t.ticketData.status?e("div",{staticClass:"appendInfo"},[e("span",{staticClass:"han"},[t._v("操作：")]),t._v(" "),t.showinput?t._e():e("el-button",{attrs:{type:"success",size:"small"},on:{click:function(a){t.showinput=!0}}},[t._v("编辑")]),t._v(" "),t.showinput?e("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(a){t.showinput=!1}}},[t._v("收起")]):t._e(),t._v(" "),t.showinput?e("el-button",{attrs:{type:"primary",size:"small",disabled:t.errortime},on:{click:t.patchForm}},[t._v("确定\n        ")]):t._e(),t._v(" "),t.showinput?e("div",{staticClass:"action"},[e("el-select",{attrs:{filterable:"",placeholder:"更新任务状态"},on:{change:t.changeProjectstatus},model:{value:t.rowdata.status,callback:function(a){t.$set(t.rowdata,"status",a)},expression:"rowdata.status"}},t._l(t.Project_Status,function(t,a){return e("el-option",{key:a,attrs:{label:t,value:a}})})),t._v(" "),"2"!==t.rowdata.status||t.ticketData.end_time?t._e():e("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"设置计划结束时间",disable:"have_endtime"},on:{change:t.changeProjectendtime},model:{value:t.rowdata.end_time,callback:function(a){t.$set(t.rowdata,"end_time",a)},expression:"rowdata.end_time"}})],1):t._e()],1):t._e()]),t._v(" "),e("vue-markdown",{attrs:{source:t.ticketData.content}}),t._v(" "),e("hr",{staticClass:"heng"}),t._v(" "),t.enclosureData.length>0?e("div",[e("ul",t._l(t.enclosureData,function(a){return a.file?e("li",{key:a.id,staticStyle:{"list-style":"none"}},[e("i",{staticClass:"fa fa-paperclip"}),t._v(" "),e("a",{attrs:{href:t.apiurl+"/upload/"+a.file,download:a.file}},[t._v(t._s(a.file.split("/")[1]))])]):t._e()}))]):t._e()],1),t._v(" "),e("el-tooltip",{attrs:{placement:"top",content:"一路向西"}},[e("back-to-top",{attrs:{transitionName:"fade",customStyle:t.BackToTopStyle,visibilityHeight:300,backPosition:50}})],1)],1)},_=[],m={render:u,staticRenderFns:_},f=m,v=e("VU/8"),g=s,k=v(h,f,!1,g,null,null);a.default=k.exports},AnfV:function(t,a,e){a=t.exports=e("FZ+f")(!1),a.push([t.i,".editticket{margin:50px;width:80%}.title{font-size:28px;font-weight:700;padding-left:10px}.right-title{font-size:20px;font-weight:600;padding-left:10px}.card-head-btn{float:right;padding:3px 0}.appendInfo{padding:5px;margin:5px}.action{margin:5px}.han{margin-left:5px}.content{margin:20px 5px}.ticketcomment{margin-top:20px;background-color:rgba(48,250,81,.17)}.ticketcomment .dialog-box{position:relative;left:100px;margin-left:-30px}.ticketcomment .dialog-box span{width:0;height:0;font-size:0;overflow:hidden;position:absolute}.ticketcomment .dialog-box span.bot{border-width:16px;border-style:solid dashed dashed;border-color:transparent rgba(48,250,81,.38) transparent transparent;top:10px;left:-30px}.ticketcomment .dialog-box .comment{border:1px solid rgba(255,164,186,.62);padding:6px;margin-bottom:10px;min-height:50px}.ticketcomment .dialog-box .comment .commenttime{float:right}",""])},DD1h:function(t,a,e){var s=e("AnfV");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);e("rjj0")("051a5c4e",s,!0)}});